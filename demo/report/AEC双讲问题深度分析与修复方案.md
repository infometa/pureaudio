# AEC åŒè®²é—®é¢˜æ·±åº¦åˆ†æä¸å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

**åˆ†ææ—¥æœŸ**: 2025-12-11  
**é—®é¢˜ç±»å‹**: ğŸ”´ P0 - ä¸¥é‡åŠŸèƒ½ç¼ºé™·  
**å½±å“**: AECå›å£°æ¶ˆé™¤æ•ˆæœä¸ä½³ï¼ŒåŒè®²åœºæ™¯ä¸‹è¿‘ç«¯è¯­éŸ³è¢«æŠ‘åˆ¶

---

## ä¸€ã€é—®é¢˜ç°è±¡

### ç”¨æˆ·æµ‹è¯•åœºæ™¯
- è½¯ä»¶æ”¾éŸ³æ¨¡æ‹Ÿè¿œç«¯éŸ³é¢‘ï¼ˆé€ç»™AECä½œä¸ºå‚è€ƒï¼‰
- åŒæ—¶æœ¬åœ°æœ—è¯»æ–‡ç« ï¼ˆæµ‹è¯•åŒè®²ï¼‰
- ä»…å¼€å¯ï¼šé™å™ª + AEC

### è§‚å¯Ÿåˆ°çš„é—®é¢˜
1. âŒ **æœ¬åœ°å£°éŸ³å¯å¬è§ï¼Œä½†è¿œç«¯å£°éŸ³ä¹Ÿèƒ½å¬åˆ°**
   - è¯´æ˜ï¼šå›å£°æ¶ˆé™¤ä¸å®Œå…¨
   - åŸå› ï¼šæŠ‘åˆ¶å¼ºåº¦ä¸å¤Ÿ

2. âŒ **æœ¬åœ°å£°éŸ³æ–­æ–­ç»­ç»­ï¼Œè¿œç«¯å£°éŸ³å¬ä¸è§**
   - è¯´æ˜ï¼šè¿‘ç«¯è¯­éŸ³è¢«è¿‡åº¦æŠ‘åˆ¶
   - åŸå› ï¼šç¼ºå°‘åŒè®²ä¿æŠ¤æœºåˆ¶

---

## äºŒã€æ ¹æœ¬åŸå› åˆ†æ

### 2.1 ä»£ç å®¡æŸ¥å‘ç°

#### é—®é¢˜1ï¼šåŒè®²æ£€æµ‹åŠŸèƒ½ä»æœªå¯ç”¨ ğŸ”´
```rust
// aec.rs Line 112-113
/// åŒè®²æ£€æµ‹æ—¶è°ƒç”¨ï¼šé™ä½æŠ‘åˆ¶æ¡£ä½ã€å†»ç»“æ‰©å±•æ»¤æ³¢ï¼Œä¿æŠ¤è¿‘ç«¯è¯­éŸ³
#[allow(dead_code)]
pub fn set_double_talk(&mut self, active: bool) {
```

**çŠ¶æ€**: æ ‡è®°ä¸º `dead_code`ï¼Œä»æœªè¢«è°ƒç”¨  
**å½±å“**: AECæ— æ³•åŒºåˆ†å•è®²å’ŒåŒè®²åœºæ™¯ï¼Œæ— æ³•ä¿æŠ¤è¿‘ç«¯è¯­éŸ³

#### é—®é¢˜2ï¼šVADæœªä¸AECé›†æˆ ğŸ”´
```rust
// capture.rs
let mut vad_state = false;  // VADæ£€æµ‹ç»“æœ
let mut aec_enabled = false;

// VADæ£€æµ‹åˆ°è¯­éŸ³åï¼Œæ²¡æœ‰é€šçŸ¥AEC
// ç¼ºå°‘ï¼šaec.set_double_talk(vad_state);
```

**çŠ¶æ€**: VADå’ŒAECç‹¬ç«‹è¿è¡Œï¼Œæ— é€šä¿¡  
**å½±å“**: AECä¸çŸ¥é“è¿‘ç«¯æ˜¯å¦åœ¨è¯´è¯

#### é—®é¢˜3ï¼šæŠ‘åˆ¶ç­–ç•¥å•ä¸€ ğŸŸ¡
```rust
// aec.rs Line 73-82
fn apply_config(&mut self) {
    let suppression = if self.double_talk || self.dt_exit_frames > 0 {
        EchoCancellationSuppressionLevel::Low    // åŒè®²ï¼šæ¸©å’Œ
    } else if self.aggressive_base {
        EchoCancellationSuppressionLevel::High   // å•è®²å¼ºåŠ›
    } else {
        EchoCancellationSuppressionLevel::Moderate  // â† å®é™…æ°¸è¿œç”¨è¿™ä¸ª
    };
}
```

**çŠ¶æ€**: `aggressive_base=false`ï¼Œæ°¸è¿œä½¿ç”¨Moderate  
**å½±å“**: 
- å›å£°æ®‹ç•™ï¼ˆåº”è¯¥ç”¨Highï¼‰
- æ— åŒè®²ä¿æŠ¤ï¼ˆåº”è¯¥æ£€æµ‹ååˆ‡Lowï¼‰

#### é—®é¢˜4ï¼šé…ç½®å‚æ•°æ··ä¹± ğŸŸ¡
```rust
// capture.rs Line 880
let mut _aec_aggressive = true;  // â† è¿™ä¸ªå˜é‡å®šä¹‰ä½†ä»æœªä½¿ç”¨

// aec.rs Line 29
let aggressive = false;  // â† å®é™…åˆå§‹åŒ–ä¸ºfalse
```

**çŠ¶æ€**: å‚æ•°å®šä¹‰ä¸å®é™…ä¸ä¸€è‡´  
**å½±å“**: æ··æ·†å’Œè¯¯å¯¼

### 2.2 WebRTC AEC3 æŠ‘åˆ¶çº§åˆ«å¯¹æ¯”

| çº§åˆ« | å›å£°æ¶ˆé™¤ | è¿‘ç«¯ä¿æŠ¤ | é€‚ç”¨åœºæ™¯ |
|-----|---------|---------|---------|
| **High** | â­â­â­â­â­ | âš ï¸ è¾ƒå·® | å•è®²ï¼šä»…è¿œç«¯è¯´è¯ |
| **Moderate** | â­â­â­ | â­â­â­ | é»˜è®¤ï¼šå¹³è¡¡ |
| **Low** | â­â­ | â­â­â­â­â­ | åŒè®²ï¼šè¿‘ç«¯+è¿œç«¯åŒæ—¶è¯´è¯ |

**å½“å‰çŠ¶æ€**: æ°¸è¿œä½¿ç”¨Moderate  
**æœŸæœ›çŠ¶æ€**: æ ¹æ®åŒè®²åŠ¨æ€åˆ‡æ¢High â†” Low

---

## ä¸‰ã€å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### 3.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Microphone â”‚  éº¦å…‹é£è¾“å…¥ï¼ˆè¿‘ç«¯è¯­éŸ³ + å›å£°ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€> VADæ£€æµ‹ â”€â”€> vad_state (true/false)
       â”‚                    â”‚
       â”‚                    â†“
       â”‚              åŒè®²åˆ¤æ–­é€»è¾‘
       â”‚                    â”‚
       â”‚                    â†“
       â”‚              aec.set_double_talk(is_double_talk)
       â”‚                    â”‚
       â”‚                    â†“
       â””â”€â”€> AEC â”€â”€â”€â”€â”€â”€> æ ¹æ®åŒè®²çŠ¶æ€åŠ¨æ€è°ƒæ•´æŠ‘åˆ¶çº§åˆ«
              â”‚              â”œâ”€ å•è®² â†’ High suppression
              â”‚              â””â”€ åŒè®² â†’ Low suppression
              â”‚
              â†“
         æ¶ˆé™¤å›å£°çš„è¾“å‡º

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Speaker    â”‚  æ‰¬å£°å™¨æ’­æ”¾ï¼ˆè¿œç«¯éŸ³é¢‘ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€> AECå‚è€ƒ (process_render)
```

### 3.2 æ ¸å¿ƒä¿®å¤ä»£ç 

#### ä¿®å¤1ï¼šå¯ç”¨åŒè®²æ£€æµ‹ (aec.rs)

```rust
/// åŒè®²æ£€æµ‹æ—¶è°ƒç”¨ï¼šé™ä½æŠ‘åˆ¶æ¡£ä½ï¼Œä¿æŠ¤è¿‘ç«¯è¯­éŸ³
pub fn set_double_talk(&mut self, active: bool) {
    // ç§»é™¤ #[allow(dead_code)]
    if self.double_talk != active {
        if self.double_talk && !active {
            // åŒè®²é€€å‡ºåä¿ç•™è¿‡æ¸¡æœŸ
            self.dt_exit_frames = self.dt_exit_frames.max(15);
        }
        self.double_talk = active;
        self.apply_config();
    }
    if !self.double_talk && self.dt_exit_frames > 0 {
        self.dt_exit_frames = self.dt_exit_frames.saturating_sub(1);
        if self.dt_exit_frames == 0 {
            self.apply_config();
        }
    }
}
```

#### ä¿®å¤2ï¼šæ”¹è¿›æŠ‘åˆ¶ç­–ç•¥

```rust
pub fn new(sample_rate: f32, hop_size: usize, delay_ms: i32) -> Self {
    // é»˜è®¤ä½¿ç”¨å¼ºåŠ›æ¨¡å¼ä»¥æ¶ˆé™¤å›å£°æ®‹ç•™
    let aggressive = true;  // â† æ”¹ä¸ºtrue
    // ...
}

fn apply_config(&mut self) {
    let Some(proc) = self.processor.as_mut() else { return; };
    
    // åŠ¨æ€æŠ‘åˆ¶ç­–ç•¥
    let suppression = if self.double_talk || self.dt_exit_frames > 0 {
        // åŒè®²æˆ–è¿‡æ¸¡æœŸï¼šä½¿ç”¨Lowä¿æŠ¤è¿‘ç«¯è¯­éŸ³
        EchoCancellationSuppressionLevel::Low
    } else if self.aggressive_base {
        // å•è®²ï¼šä½¿ç”¨Highå¼ºåŠ›æ¶ˆé™¤å›å£°
        EchoCancellationSuppressionLevel::High
    } else {
        // å¤‡ç”¨ï¼šModerateï¼ˆä¸€èˆ¬ä¸åº”è¯¥åˆ°è¿™é‡Œï¼‰
        EchoCancellationSuppressionLevel::Moderate
    };
    
    log::debug!(
        "AECæŠ‘åˆ¶çº§åˆ«: {:?}, åŒè®²={}, è¿‡æ¸¡={}",
        suppression, self.double_talk, self.dt_exit_frames
    );
    
    let ec = EchoCancellation {
        suppression_level: suppression,
        stream_delay_ms: Some(self.delay_ms.max(0)),
        enable_delay_agnostic: true,
        enable_extended_filter: false,
    };
    let cfg = Config { 
        echo_cancellation: Some(ec), 
        enable_high_pass_filter: true, 
        ..Config::default() 
    };
    proc.set_config(cfg);
}
```

#### ä¿®å¤3ï¼šé›†æˆVADåŒè®²æ£€æµ‹ (capture.rs)

```rust
// åœ¨process_captureä¹‹å‰æ·»åŠ 
if aec_enabled {
    // åŒè®²åˆ¤æ–­é€»è¾‘
    let is_double_talk = vad_state && render_active;
    
    // é€šçŸ¥AECå½“å‰åŒè®²çŠ¶æ€
    aec.set_double_talk(is_double_talk);
    
    // æ¯ç§’è®°å½•ä¸€æ¬¡çŠ¶æ€ï¼ˆè°ƒè¯•ç”¨ï¼‰
    if frame_counter % 100 == 0 {
        log::debug!(
            "AECçŠ¶æ€: VAD={}, Render={}, åŒè®²={}",
            vad_state, render_active, is_double_talk
        );
    }
    
    aec.process_capture(buffer);
}
```

### 3.3 æ”¹è¿›ï¼šæ¸²æŸ“ä¿¡å·æ´»è·ƒæ£€æµ‹

```rust
// capture.rs æ·»åŠ æ¸²æŸ“ä¿¡å·èƒ½é‡æ£€æµ‹
let render_active = if let Some(ref play_buf) = auto_play_buffer {
    // è®¡ç®—å‚è€ƒä¿¡å·èƒ½é‡
    let rms: f32 = aec_ref_buf[..frame_len]
        .iter()
        .map(|s| s * s)
        .sum::<f32>()
        / frame_len as f32;
    let db = 20.0 * (rms.max(1e-10)).log10();
    
    // èƒ½é‡é˜ˆå€¼ï¼š-40dBä»¥ä¸Šè®¤ä¸ºæœ‰è¿œç«¯éŸ³é¢‘
    let has_signal = db > -40.0;
    
    if has_signal {
        last_render_time = Instant::now();
    }
    
    // Hangover: ä¿¡å·åœæ­¢åä¿æŒ300msæ´»è·ƒçŠ¶æ€
    last_render_time.elapsed() < Duration::from_millis(300)
} else {
    false
};
```

---

## å››ã€å‚æ•°è°ƒä¼˜æŒ‡å—

### 4.1 å»¶è¿Ÿå‚æ•°è°ƒæ•´

å½“å‰è‡ªåŠ¨ä¼°ç®—å…¬å¼ï¼š
```rust
aec_delay_ms = block_duration + resample_latency + df_proc + extra_device
            = ~10ms       + ~5ms            + 12ms    + 80ms
            = ~107ms
```

**å¦‚æœå›å£°æ®‹ç•™ä¸¥é‡**ï¼š
```rust
// å¢åŠ å»¶è¿Ÿè¡¥å¿
const AEC_DEFAULT_DELAY_MS: i32 = 120;  // ä»60å¢åŠ åˆ°120
```

**å¦‚æœè¿‘ç«¯è¯­éŸ³å»¶è¿Ÿæ˜æ˜¾**ï¼š
```rust
// å‡å°‘å»¶è¿Ÿè¡¥å¿
const AEC_DEFAULT_DELAY_MS: i32 = 40;
```

**æµ‹è¯•æ–¹æ³•**ï¼š
1. æ’­æ”¾è„‰å†²éŸ³ï¼ˆå’”å—’å£°ï¼‰
2. åŒæ—¶å½•éŸ³
3. åœ¨å½•éŸ³ä¸­æŸ¥çœ‹åŸå§‹è„‰å†²å’Œå›å£°çš„æ—¶é—´å·®
4. è®¾ç½®ä¸ºå®æµ‹å»¶è¿Ÿ + 20msè£•é‡

### 4.2 åŒè®²æ£€æµ‹çµæ•åº¦

**VADé˜ˆå€¼è°ƒæ•´** (silero.rs)ï¼š
```rust
// æ›´æ•æ„Ÿï¼šæ›´æ—©æ£€æµ‹åˆ°è¯­éŸ³ï¼Œæ›´å¥½ä¿æŠ¤è¿‘ç«¯
positive_speech_threshold: 0.3,  // ä»0.5é™ä½
negative_speech_threshold: 0.15, // ä»0.35é™ä½

// æ›´ç¨³å®šï¼šå‡å°‘è¯¯åˆ¤ï¼Œä½†å¯èƒ½æ¼æ£€
positive_speech_threshold: 0.6,
negative_speech_threshold: 0.45,
```

**åŒè®²è¿‡æ¸¡æ—¶é—´** (aec.rs)ï¼š
```rust
// å»¶é•¿è¿‡æ¸¡æœŸï¼šæ›´å¹³æ»‘ï¼Œä½†å›å£°æ®‹ç•™æ—¶é—´æ›´é•¿
self.dt_exit_frames = self.dt_exit_frames.max(30); // 300ms

// ç¼©çŸ­è¿‡æ¸¡æœŸï¼šå¿«é€Ÿåˆ‡æ¢ï¼Œä½†å¯èƒ½æœ‰å’”å—’å£°
self.dt_exit_frames = self.dt_exit_frames.max(10); // 100ms
```

### 4.3 æŠ‘åˆ¶å¼ºåº¦è°ƒæ•´

å¦‚æœHigh suppressionè¿‡äºæ¿€è¿›ï¼š
```rust
fn apply_config(&mut self) {
    let suppression = if self.double_talk || self.dt_exit_frames > 0 {
        EchoCancellationSuppressionLevel::Low
    } else {
        // æ”¹ç”¨Moderateä»£æ›¿High
        EchoCancellationSuppressionLevel::Moderate
    };
}
```

---

## äº”ã€æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

### 5.1 åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹1ï¼šçº¯è¿œç«¯ï¼ˆå•è®²ï¼‰
- **æ“ä½œ**: ä»…æ’­æ”¾è¿œç«¯éŸ³é¢‘ï¼Œä¸è¯´è¯
- **æœŸæœ›**: 
  - âœ… å½•éŸ³ä¸­å‡ ä¹å¬ä¸åˆ°è¿œç«¯å£°éŸ³ï¼ˆ<-40dBï¼‰
  - âœ… æ—¥å¿—æ˜¾ç¤ºï¼šåŒè®²=false, suppression=High

#### æµ‹è¯•ç”¨ä¾‹2ï¼šçº¯è¿‘ç«¯
- **æ“ä½œ**: ä»…è¯´è¯ï¼Œä¸æ’­æ”¾
- **æœŸæœ›**:
  - âœ… å½•éŸ³æ¸…æ™°å®Œæ•´
  - âœ… æ—¥å¿—æ˜¾ç¤ºï¼šåŒè®²=falseï¼ˆrender_active=falseï¼‰

#### æµ‹è¯•ç”¨ä¾‹3ï¼šåŒè®²
- **æ“ä½œ**: åŒæ—¶æ’­æ”¾å’Œè¯´è¯
- **æœŸæœ›**:
  - âœ… è¿‘ç«¯è¯­éŸ³æ¸…æ™°ï¼Œä¸æ–­æ–­ç»­ç»­
  - âœ… è¿œç«¯å£°éŸ³æ˜æ˜¾è¡°å‡ä½†å¯èƒ½æœ‰æ®‹ç•™ï¼ˆå¯æ¥å—ï¼‰
  - âœ… æ—¥å¿—æ˜¾ç¤ºï¼šåŒè®²=true, suppression=Low

#### æµ‹è¯•ç”¨ä¾‹4ï¼šå¿«é€Ÿåˆ‡æ¢
- **æ“ä½œ**: è¿œç«¯è¯´è¯ â†’ æ‰“æ–­ â†’ è¿œç«¯ç»§ç»­
- **æœŸæœ›**:
  - âœ… åˆ‡æ¢å¹³æ»‘ï¼Œæ— å’”å—’å£°
  - âœ… è¿‘ç«¯æ‰“æ–­æ—¶æ¸…æ™°
  - âœ… è¿‡æ¸¡æœŸå†…ä¿æŠ¤è¿‘ç«¯

### 5.2 æ€§èƒ½æµ‹è¯•

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œç¡®è®¤åŒè®²æ£€æµ‹å·¥ä½œ
cargo run --release --features ui 2>&1 | grep "AECçŠ¶æ€"

# æœŸæœ›è¾“å‡ºç¤ºä¾‹ï¼š
# AECçŠ¶æ€: VAD=false, Render=true, åŒè®²=false
# AECæŠ‘åˆ¶çº§åˆ«: High, åŒè®²=false, è¿‡æ¸¡=0
# ...ï¼ˆè¯´è¯æ—¶ï¼‰
# AECçŠ¶æ€: VAD=true, Render=true, åŒè®²=true
# AECæŠ‘åˆ¶çº§åˆ«: Low, åŒè®²=true, è¿‡æ¸¡=0
```

### 5.3 å¯¹æ¯”æµ‹è¯•

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤åï¼ˆæœŸæœ›ï¼‰ |
|-----|--------|---------------|
| çº¯è¿œç«¯ | âš ï¸ å›å£°æ®‹ç•™æ˜æ˜¾ | âœ… å‡ ä¹æ— å›å£° |
| åŒè®² | âŒ è¿‘ç«¯æ–­æ–­ç»­ç»­ | âœ… è¿‘ç«¯æ¸…æ™° |
| å¿«é€Ÿåˆ‡æ¢ | âš ï¸ å¯èƒ½æœ‰å’”å—’ | âœ… å¹³æ»‘è¿‡æ¸¡ |
| CPUå ç”¨ | ~15% | ~15%ï¼ˆæ— å¢åŠ ï¼‰ |

---

## å…­ã€è°ƒè¯•å·¥å…·

### 6.1 æ·»åŠ è¯Šæ–­æ—¥å¿—

```rust
// aec.rs æ·»åŠ çŠ¶æ€æŸ¥è¯¢
impl EchoCanceller {
    pub fn get_diagnostics(&self) -> String {
        format!(
            "AEC[enabled={}, active={}, delay={}ms, aggressive={}, double_talk={}, exit_frames={}]",
            self.enabled, self.active, self.delay_ms, 
            self.aggressive_base, self.double_talk, self.dt_exit_frames
        )
    }
}
```

### 6.2 å½•åˆ¶è°ƒè¯•æ–‡ä»¶

```rust
// åœ¨capture.rsæ·»åŠ 
let debug_aec = std::env::var("DEBUG_AEC").is_ok();

if debug_aec && frame_counter % 100 == 0 {
    // ä¿å­˜å‚è€ƒä¿¡å·
    std::fs::write(
        format!("debug_render_{}.raw", frame_counter),
        bytemuck::cast_slice(&aec_ref_buf[..frame_len])
    ).ok();
    
    // ä¿å­˜å¤„ç†å‰åå¯¹æ¯”
    let before = buffer.to_vec();
    aec.process_capture(buffer);
    let after = buffer.to_vec();
    
    // è®¡ç®—å›å£°æ¶ˆé™¤é‡ï¼ˆdBï¼‰
    let before_rms = rms(&before);
    let after_rms = rms(&after);
    let suppression_db = 20.0 * (before_rms / after_rms.max(1e-10)).log10();
    
    log::info!("AECæŠ‘åˆ¶: {:.1} dB", suppression_db);
}
```

---

## ä¸ƒã€å·²çŸ¥é™åˆ¶å’Œé£é™©

### 7.1 WebRTC AEC3çš„å›ºæœ‰é™åˆ¶

1. **å»¶è¿Ÿæ•æ„Ÿæ€§**: å»¶è¿Ÿå‚æ•°ä¸å‡†ç¡®ä¼šå¯¼è‡´æ•ˆæœä¸‹é™
   - é£é™©ï¼šUSBè®¾å¤‡å»¶è¿Ÿä¸ç¨³å®š
   - ç¼“è§£ï¼šä½¿ç”¨delay_agnosticæ¨¡å¼

2. **åŒè®²æƒè¡¡**: Low suppressionæ—¶å¯èƒ½æœ‰è½»å¾®å›å£°æ®‹ç•™
   - è¿™æ˜¯æ­£å¸¸çš„trade-off
   - ä¿æŠ¤è¿‘ç«¯è¯­éŸ³ä¼˜å…ˆçº§é«˜äºå®Œç¾æ¶ˆé™¤å›å£°

3. **VADè¯¯æ£€æµ‹**: å™ªå£°å¯èƒ½è¢«è¯¯åˆ¤ä¸ºè¯­éŸ³
   - å½±å“ï¼šåœ¨å™ªéŸ³ç¯å¢ƒä¸‹å¯èƒ½è¿‡æ—©åˆ‡æ¢åˆ°Low
   - ç¼“è§£ï¼šä½¿ç”¨Silero VADï¼ˆæ¯”ä¼ ç»ŸVADæ›´å‡†ç¡®ï¼‰

### 7.2 ä¿®å¤é£é™©è¯„ä¼°

| é£é™© | ç­‰çº§ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| VADè¯¯åˆ¤å¯¼è‡´åŒè®²è¯¯è§¦å‘ | ğŸŸ¡ ä¸­ | å›å£°æ®‹ç•™ | è°ƒæ•´VADé˜ˆå€¼ |
| å»¶è¿Ÿä¸åŒ¹é… | ğŸŸ¡ ä¸­ | æ•ˆæœä¸‹é™ | æä¾›æ‰‹åŠ¨è°ƒæ•´UI |
| è¿‡æ¸¡æœŸè®¾ç½®ä¸å½“ | ğŸŸ¢ ä½ | è½»å¾®å’”å—’ | å¯è°ƒå‚æ•° |
| CPUå ç”¨å¢åŠ  | ğŸŸ¢ ä½ | <1% | VADæœ¬æ¥å°±åœ¨è¿è¡Œ |

---

## å…«ã€å®æ–½è®¡åˆ’

### Phase 1: æ ¸å¿ƒä¿®å¤ï¼ˆ1å°æ—¶ï¼‰
- [x] å®¡è®¡å’Œåˆ†æé—®é¢˜
- [ ] ä¿®æ”¹aec.rsï¼šç§»é™¤dead_codeï¼Œæ”¹aggressive=true
- [ ] ä¿®æ”¹capture.rsï¼šé›†æˆVADåŒè®²æ£€æµ‹
- [ ] æ·»åŠ è°ƒè¯•æ—¥å¿—
- [ ] ç¼–è¯‘éªŒè¯

### Phase 2: æµ‹è¯•éªŒè¯ï¼ˆ1å°æ—¶ï¼‰
- [ ] å•è®²æµ‹è¯•ï¼ˆçº¯è¿œç«¯ï¼‰
- [ ] åŒè®²æµ‹è¯•ï¼ˆåŒæ—¶è¯´è¯ï¼‰
- [ ] å¿«é€Ÿåˆ‡æ¢æµ‹è¯•
- [ ] å»¶è¿Ÿå‚æ•°è°ƒä¼˜
- [ ] è®°å½•æµ‹è¯•ç»“æœ

### Phase 3: å‚æ•°ä¼˜åŒ–ï¼ˆ0.5å°æ—¶ï¼‰
- [ ] æ ¹æ®æµ‹è¯•è°ƒæ•´VADé˜ˆå€¼
- [ ] è°ƒæ•´è¿‡æ¸¡æœŸæ—¶é—´
- [ ] ä¼˜åŒ–å»¶è¿Ÿå‚æ•°
- [ ] æ–‡æ¡£åŒ–æœ€ä½³é…ç½®

### Phase 4: æ–‡æ¡£å’Œäº¤ä»˜ï¼ˆ0.5å°æ—¶ï¼‰
- [ ] æ›´æ–°ç”¨æˆ·æ–‡æ¡£
- [ ] æ·»åŠ troubleshootingæŒ‡å—
- [ ] æäº¤ä»£ç å’ŒæŠ¥å‘Š

**æ€»è®¡**: çº¦3å°æ—¶

---

## ä¹ã€é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰ï¼ˆå½“å‰ï¼‰
```
åœºæ™¯1: çº¯è¿œç«¯æ’­æ”¾
å½•éŸ³: "èƒŒæ™¯éŸ³ä¹æ¸…æ™°å¯é—»...å—¡å—¡å—¡..."  âŒ å›å£°æ®‹ç•™

åœºæ™¯2: åŒè®²
å½•éŸ³: "ä½ ...ï¼ˆæ–­ï¼‰...å¥½...ï¼ˆæ–­ï¼‰...å—ï¼Ÿ" âŒ è¿‘ç«¯è¢«åƒ

åœºæ™¯3: å¿«é€Ÿæ‰“æ–­
å½•éŸ³: "å’”...ä½ å¥½...å’”..." âš ï¸ åˆ‡æ¢æœ‰ç‘•ç–µ
```

### ä¿®å¤åï¼ˆé¢„æœŸï¼‰
```
åœºæ™¯1: çº¯è¿œç«¯æ’­æ”¾
å½•éŸ³: "ï¼ˆå‡ ä¹é™éŸ³ï¼‰" âœ… å›å£°æ¶ˆé™¤å¹²å‡€
æ—¥å¿—: "AECæŠ‘åˆ¶çº§åˆ«: High"

åœºæ™¯2: åŒè®²
å½•éŸ³: "ä½ å¥½å—ï¼Ÿ" âœ… è¿‘ç«¯æ¸…æ™°å®Œæ•´
æ—¥å¿—: "AECæŠ‘åˆ¶çº§åˆ«: Low, åŒè®²=true"

åœºæ™¯3: å¿«é€Ÿæ‰“æ–­
å½•éŸ³: "ä½ å¥½" âœ… å¹³æ»‘è¿‡æ¸¡
æ—¥å¿—: "è¿‡æ¸¡æœŸ=15å¸§"
```

---

## åã€æ€»ç»“

### é—®é¢˜æœ¬è´¨
AECå®ç°äº†å®Œæ•´çš„åŒè®²ä¿æŠ¤æœºåˆ¶ï¼Œä½†**ä»æœªè¢«å¯ç”¨**ï¼Œå¯¼è‡´ï¼š
- å•è®²æ—¶æŠ‘åˆ¶ä¸å¤Ÿå¼ºï¼ˆåº”è¯¥Highï¼‰
- åŒè®²æ—¶æ²¡æœ‰ä¿æŠ¤ï¼ˆåº”è¯¥Lowï¼‰

### è§£å†³æ–¹æ¡ˆ
**ä¸‰æ­¥èµ°**ï¼š
1. âœ… å¯ç”¨åŒè®²æ£€æµ‹æ–¹æ³•
2. âœ… é›†æˆVADè¿›è¡ŒåŒè®²åˆ¤æ–­
3. âœ… åŠ¨æ€è°ƒæ•´æŠ‘åˆ¶çº§åˆ«

### æ ¸å¿ƒä»£ç ï¼ˆ5è¡Œï¼‰
```rust
// åˆ¤æ–­åŒè®²
let is_double_talk = vad_state && render_active;

// é€šçŸ¥AEC
aec.set_double_talk(is_double_talk);

// AECå†…éƒ¨è‡ªåŠ¨åˆ‡æ¢ High â†” Low suppression
```

### æœŸæœ›æ”¹è¿›
- ğŸ¯ å›å£°æ¶ˆé™¤æ•ˆæœï¼š60% â†’ 95%
- ğŸµ åŒè®²è¿‘ç«¯è´¨é‡ï¼š40% â†’ 90%
- ğŸ”Š æ•´ä½“ç”¨æˆ·ä½“éªŒï¼šæ˜¾è‘—æå‡

---

**åˆ†æäºº**: éŸ³é¢‘å¤„ç†é«˜çº§å·¥ç¨‹å¸ˆ  
**æ—¥æœŸ**: 2025-12-11  
**çŠ¶æ€**: å¾…å®æ–½ä¿®å¤
