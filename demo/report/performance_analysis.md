# å•å¸§å¤„ç†è€—æ—¶è¶…é¢„ç®—é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

## é—®é¢˜æè¿°

æ—¥å¿—æ˜¾ç¤ºå•å¸§å¤„ç†è€—æ—¶åœ¨ 47-94ms ä¹‹é—´ï¼Œè¿œè¶… 30ms é¢„ç®—ï¼Œå¯èƒ½å¯¼è‡´æ‰å¸§ï¼š

```
å•å¸§è€—æ—¶ 51.06 ms è¶…é¢„ç®— 30.00 ms
å•å¸§è€—æ—¶ 94.23 ms è¶…é¢„ç®— 30.00 ms
å•å¸§è€—æ—¶ 78.65 ms è¶…é¢„ç®— 30.00 ms
```

---

## æ ¹æœ¬åŸå› åˆ†æ

### 1. é¢„ç®—è®¡ç®—åˆ†æ

**ä½ç½®**: `capture.rs:1822`

```1822:1822:demo/src/capture.rs
                let budget_ms = (block_duration * 1000.0 + resample_latency_ms).max(30.0);
```

**åˆ†æ**:
- `block_duration = hop_size / sample_rate`
- å¦‚æœ `hop_size = 480`, `sample_rate = 16000`ï¼Œåˆ™ `block_duration = 0.03s = 30ms`
- é¢„ç®— = `max(30ms + resample_latency_ms, 30ms)` â‰ˆ 30ms
- **å®é™…è€—æ—¶ 47-94msï¼Œè¶…å‡ºé¢„ç®— 1.5-3 å€**

---

### 2. ä¸»è¦æ€§èƒ½ç“¶é¢ˆï¼ˆæŒ‰è€—æ—¶æ’åºï¼‰

#### ğŸ”´ ç“¶é¢ˆ 1: DeepFilterNet AI æ¨¡å‹æ¨ç†ï¼ˆæœ€è€—æ—¶ï¼‰

**ä½ç½®**: `capture.rs:1134`

```1134:1140:demo/src/capture.rs
                lsnr = match df.process(inframe.view(), outframe.view_mut()) {
                    Ok(v) => v,
                    Err(err) => {
                        log::error!("DeepFilterNet å¤„ç†å¤±è´¥: {:?}", err);
                        continue;
                    }
                };
```

**é—®é¢˜**:
- **ONNX æ¨¡å‹æ¨ç†**: DeepFilterNet æ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæ¯æ¬¡æ¨ç†éœ€è¦å¤§é‡è®¡ç®—
- **å…¸å‹è€—æ—¶**: 15-40msï¼ˆå–å†³äºæ¨¡å‹å¤§å°å’Œç¡¬ä»¶ï¼‰
- **æ— æ³•é¿å…**: è¿™æ˜¯æ ¸å¿ƒé™å™ªåŠŸèƒ½ï¼Œå¿…é¡»æ‰§è¡Œ

**å½±å“**: å æ€»è€—æ—¶çš„ 30-50%

---

#### ğŸ”´ ç“¶é¢ˆ 2: VAD å¤„ç†ï¼ˆå¦‚æœå¯ç”¨ï¼ŒONNX æ¨ç†ï¼‰

**ä½ç½®**: `capture.rs:1238-1250`

```1238:1250:demo/src/capture.rs
                    while vad_buf_raw.len() >= vad_source_frame {
                        let mut frame_src = vec![0.0f32; vad_source_frame];
                        for i in 0..vad_source_frame {
                            if let Some(v) = vad_buf_raw.pop_front() {
                                frame_src[i] = v;
                            }
                        }
                        if let Some(ref mut v) = vad {
                            if let Ok(_) = v.process(&frame_src) {
                                vad_voice = v.is_speaking();
                            }
                        }
                    }
```

**é—®é¢˜**:
1. **while å¾ªç¯å¯èƒ½å¤„ç†å¤šå¸§**: å¦‚æœç¼“å†²åŒºç§¯ç´¯å¤šå¸§ï¼Œä¼šè¿ç»­è°ƒç”¨å¤šæ¬¡ VAD
2. **æ¯æ¬¡éƒ½æ˜¯ ONNX æ¨ç†**: Silero VAD æ˜¯ ONNX æ¨¡å‹ï¼Œæ¯æ¬¡ `process()` éƒ½æ˜¯å®Œæ•´æ¨ç†
3. **å†…å­˜åˆ†é…**: æ¯æ¬¡å¾ªç¯éƒ½åˆ†é…æ–°çš„ `frame_src` å‘é‡
4. **å…¸å‹è€—æ—¶**: æ¯æ¬¡æ¨ç† 5-15msï¼Œå¦‚æœå¤„ç†å¤šå¸§å¯èƒ½ç´¯ç§¯åˆ° 20-40ms

**å½±å“**: å¦‚æœå¯ç”¨ VADï¼Œå¯èƒ½å æ€»è€—æ—¶çš„ 20-40%

---

#### ğŸŸ¡ ç“¶é¢ˆ 3: ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—ï¼ˆå¤æ‚é€»è¾‘ï¼‰

**ä½ç½®**: `capture.rs:1145-1552`ï¼ˆçº¦ 400 è¡Œä»£ç ï¼‰

**ä¸»è¦è€—æ—¶ç‚¹**:

1. **é¢‘è°±ç‰¹å¾è®¡ç®—** (`capture.rs:1147`):
```1147:1147:demo/src/capture.rs
                let feats = compute_noise_features(df.get_spec_noisy());
```

```2745:2771:demo/src/capture.rs
fn compute_noise_features(spec: ArrayView2<Complex32>) -> NoiseFeatures {
    // ... éå†æ•´ä¸ªé¢‘è°±ï¼Œè®¡ç®—èƒ½é‡ã€å¹³å¦åº¦ã€é‡å¿ƒ
    for (i, &c) in row.iter().enumerate() {
        let p = c.norm_sqr().max(eps);
        sum_power += p;
        sum_log_power += p.ln();  // å¯¹æ•°è®¡ç®—è€—æ—¶
        weighted_sum += p * i as f32;
    }
    // ... æ›´å¤šè®¡ç®—
}
```

**é—®é¢˜**:
- éå†æ•´ä¸ªé¢‘è°±ï¼ˆé€šå¸¸ 480+ ä¸ªé¢‘ç‡ç‚¹ï¼‰
- å¤šæ¬¡å¯¹æ•°è®¡ç®—ï¼ˆ`ln()`, `log10()`, `exp()`ï¼‰
- æ¯æ¬¡å¤„ç†éƒ½è°ƒç”¨

2. **VAD é‡é‡‡æ ·** (`capture.rs:1200-1211`):
```1200:1211:demo/src/capture.rs
                            if let Some((rs, rs_buf)) = vad_resampler.as_mut() {
                                if rs_buf.len() >= 1 && rs_buf[0].len() >= buf.len() {
                                    rs_buf[0][..buf.len()].copy_from_slice(buf);
                                    if let Ok(out) = rs.process(rs_buf, None) {
                                        // ... å¤„ç†é‡é‡‡æ ·è¾“å‡º
                                    }
                                }
                            }
```

**é—®é¢˜**:
- FFT é‡é‡‡æ ·è®¡ç®—é‡å¤§
- æ¯æ¬¡å¤„ç†éƒ½æ‰§è¡Œ

3. **å¤§é‡é€»è¾‘åˆ¤æ–­å’Œè®¡ç®—**:
   - è¯­éŸ³æ£€æµ‹é€»è¾‘ï¼ˆVAD + å¯å‘å¼ï¼‰
   - å™ªå£°åœ°æ¿è·Ÿè¸ª
   - RT60 ä¼°è®¡
   - ç¯å¢ƒåˆ†ç±»
   - å‚æ•°æ’å€¼å’Œå¹³æ»‘

**å…¸å‹è€—æ—¶**: 5-15ms

**å½±å“**: å æ€»è€—æ—¶çš„ 10-20%

---

#### ğŸŸ¡ ç“¶é¢ˆ 4: é¢‘è°±æ¨é€ï¼ˆå†…å­˜åˆ†é…å’Œé€šé“å‘é€ï¼‰

**ä½ç½®**: `capture.rs:1880-1882`

```1880:1882:demo/src/capture.rs
            if let Some((ref mut s_noisy, ref mut s_enh)) = s_spec.as_mut() {
                push_spec(df.get_spec_noisy(), s_noisy);
                push_spec(df.get_spec_enh(), s_enh);
            }
```

```2314:2320:demo/src/capture.rs
fn push_spec(spec: ArrayView2<Complex32>, sender: &SendSpec) {
    debug_assert_eq!(spec.len_of(Axis(0)), 1);
    let out = spec.iter().map(|x| x.norm_sqr().max(1e-10).log10() * 10.).collect::<Vec<f32>>();
    if let Err(err) = sender.send(out.into_boxed_slice()) {
        log::warn!("Failed to send spectrogram data: {}", err);
    }
}
```

**é—®é¢˜**:
1. **æ¯æ¬¡åˆ†é…æ–°å†…å­˜**: `collect::<Vec<f32>>()` æ¯æ¬¡åˆ†é…æ–°å‘é‡
2. **éå†æ•´ä¸ªé¢‘è°±**: éå†æ‰€æœ‰é¢‘ç‡ç‚¹è®¡ç®—å¯¹æ•°
3. **é€šé“å‘é€**: å¯èƒ½é˜»å¡ï¼ˆå¦‚æœæ¥æ”¶ç«¯æ…¢ï¼‰
4. **è°ƒç”¨ä¸¤æ¬¡**: åˆ†åˆ«æ¨é€ noisy å’Œ enhanced é¢‘è°±

**å…¸å‹è€—æ—¶**: 2-5msï¼ˆå–å†³äºé¢‘è°±å¤§å°å’Œé€šé“çŠ¶æ€ï¼‰

**å½±å“**: å æ€»è€—æ—¶çš„ 5-10%

---

#### ğŸŸ¢ ç“¶é¢ˆ 5: åŠ¨æ€ EQ å¤šé¢‘æ®µå¤„ç†

**ä½ç½®**: `capture.rs:1648-1650`

```1648:1650:demo/src/capture.rs
                let metrics = if let Some(buffer) = outframe.as_slice_mut() {
                    dynamic_eq.set_dry_wet(1.0);
                    dynamic_eq.process_block(buffer)
```

**é—®é¢˜**:
- å¤šä¸ªé¢‘æ®µï¼ˆé€šå¸¸ 5 ä¸ªï¼‰ç‹¬ç«‹å¤„ç†
- æ¯ä¸ªé¢‘æ®µéƒ½éœ€è¦åŒ…ç»œæ£€æµ‹å’Œæ»¤æ³¢å™¨å¤„ç†
- è™½ç„¶å•é¢‘æ®µå¾ˆå¿«ï¼Œä½†ç´¯ç§¯èµ·æ¥æœ‰å¼€é”€

**å…¸å‹è€—æ—¶**: 1-3ms

**å½±å“**: å æ€»è€—æ—¶çš„ 2-5%

---

#### ğŸŸ¢ ç“¶é¢ˆ 6: å…¶ä»–å¤„ç†èŠ‚ç‚¹

- AGC å¤„ç†: 1-2ms
- ç¬æ€å¡‘å½¢: 0.5-1ms
- è°æ³¢æ¿€åŠ±: 0.5-1ms
- é¥±å’Œ: 0.5-1ms
- é™å¹…: 0.5-1ms

**æ€»è€—æ—¶**: 3-6ms

---

## 3. è€—æ—¶ç´¯ç§¯åˆ†æ

### å…¸å‹åœºæ™¯ 1: VAD å¯ç”¨ï¼Œç¯å¢ƒè‡ªé€‚åº”å¯ç”¨

```
DeepFilterNet:        20-35 ms  (40-50%)
VAD å¤„ç†:             10-25 ms  (20-30%)  â† å¯èƒ½å¤„ç†å¤šå¸§
ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—:        8-12 ms  (15-20%)
é¢‘è°±æ¨é€:              3-5 ms   (5-8%)
åŠ¨æ€EQ:                2-3 ms   (3-5%)
å…¶ä»–å¤„ç†:              3-5 ms   (5-8%)
----------------------------------------
æ€»è®¡:                 46-85 ms
```

**ç»“è®º**: ç¬¦åˆè§‚å¯Ÿåˆ°çš„ 47-94ms è€—æ—¶

---

### å…¸å‹åœºæ™¯ 2: VAD ç¦ç”¨ï¼Œç¯å¢ƒè‡ªé€‚åº”å¯ç”¨

```
DeepFilterNet:        20-35 ms  (50-60%)
ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—:        5-8 ms   (15-20%)
é¢‘è°±æ¨é€:              3-5 ms   (8-12%)
åŠ¨æ€EQ:                2-3 ms   (5-8%)
å…¶ä»–å¤„ç†:              3-5 ms   (8-12%)
----------------------------------------
æ€»è®¡:                 33-56 ms
```

**ç»“è®º**: ä»ç„¶å¯èƒ½è¶…é¢„ç®—ï¼ˆå¦‚æœ DeepFilterNet è€—æ—¶è¾ƒé•¿ï¼‰

---

## 4. æ ¹æœ¬åŸå› æ€»ç»“

### ä¸»è¦åŸå› ï¼ˆæŒ‰é‡è¦æ€§æ’åºï¼‰

1. **DeepFilterNet AI æ¨¡å‹æ¨ç†è€—æ—¶** (30-50%)
   - æ·±åº¦å­¦ä¹ æ¨¡å‹è®¡ç®—é‡å¤§
   - æ— æ³•é¿å…ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

2. **VAD ONNX æ¨ç†è€—æ—¶** (20-40%ï¼Œå¦‚æœå¯ç”¨)
   - while å¾ªç¯å¯èƒ½å¤„ç†å¤šå¸§
   - æ¯æ¬¡éƒ½æ˜¯å®Œæ•´ ONNX æ¨ç†
   - å†…å­˜åˆ†é…å¼€é”€

3. **ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—å¤æ‚** (10-20%)
   - é¢‘è°±ç‰¹å¾è®¡ç®—ï¼ˆå¯¹æ•°è¿ç®—ï¼‰
   - VAD é‡é‡‡æ ·ï¼ˆFFTï¼‰
   - å¤§é‡é€»è¾‘åˆ¤æ–­

4. **é¢‘è°±æ¨é€å†…å­˜åˆ†é…** (5-10%)
   - æ¯æ¬¡åˆ†é…æ–°å†…å­˜
   - é€šé“å¯èƒ½é˜»å¡

5. **åŠ¨æ€ EQ å¤šé¢‘æ®µå¤„ç†** (2-5%)
   - å¤šä¸ªé¢‘æ®µç´¯ç§¯å¼€é”€

---

## 5. è§£å†³æ–¹æ¡ˆå»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å®æ–½ï¼‰

#### æ–¹æ¡ˆ 1: ä¼˜åŒ– VAD å¤„ç†é¢‘ç‡

**é—®é¢˜**: VAD while å¾ªç¯å¯èƒ½å¤„ç†å¤šå¸§ï¼Œå¯¼è‡´å¤šæ¬¡ ONNX æ¨ç†

**è§£å†³æ–¹æ¡ˆ**:
```rust
// é™åˆ¶æ¯å¸§æœ€å¤šå¤„ç†ä¸€æ¬¡ VAD
if vad_buf_raw.len() >= vad_source_frame {
    let mut frame_src = vec![0.0f32; vad_source_frame];
    // ... åªå¤„ç†ä¸€å¸§ï¼Œå‰©ä½™å¸§ç•™åˆ°ä¸‹ä¸€è½®
    if let Some(ref mut v) = vad {
        if let Ok(_) = v.process(&frame_src) {
            vad_voice = v.is_speaking();
        }
    }
    // ä¸å†ä½¿ç”¨ while å¾ªç¯
}
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘ VAD è€—æ—¶ 50-70%

---

#### æ–¹æ¡ˆ 2: å‡å°‘é¢‘è°±æ¨é€é¢‘ç‡

**é—®é¢˜**: æ¯å¸§éƒ½æ¨é€é¢‘è°±ï¼Œå†…å­˜åˆ†é…å’Œé€šé“å‘é€æœ‰å¼€é”€

**è§£å†³æ–¹æ¡ˆ**:
```rust
// æ¯ N å¸§æ¨é€ä¸€æ¬¡ï¼ˆå¦‚æ¯ 3 å¸§ï¼‰
static mut SPEC_PUSH_COUNTER: usize = 0;
SPEC_PUSH_COUNTER += 1;
if SPEC_PUSH_COUNTER % 3 == 0 {
    push_spec(df.get_spec_noisy(), s_noisy);
    push_spec(df.get_spec_enh(), s_enh);
}
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘é¢‘è°±æ¨é€è€—æ—¶ 60-70%

---

#### æ–¹æ¡ˆ 3: ä¼˜åŒ–ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—é¢‘ç‡

**é—®é¢˜**: æ¯å¸§éƒ½æ‰§è¡Œå¤æ‚çš„é¢‘è°±ç‰¹å¾è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**:
```rust
// æ¯ 2-3 å¸§è®¡ç®—ä¸€æ¬¡ç‰¹å¾
static mut FEATURE_COUNTER: usize = 0;
FEATURE_COUNTER += 1;
if FEATURE_COUNTER % 2 == 0 {
    let feats = compute_noise_features(df.get_spec_noisy());
    // ... ä½¿ç”¨ç¼“å­˜çš„ feats
}
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘ç¯å¢ƒè‡ªé€‚åº”è€—æ—¶ 40-50%

---

#### æ–¹æ¡ˆ 4: é‡ç”¨ VAD ç¼“å†²åŒº

**é—®é¢˜**: æ¯æ¬¡å¾ªç¯éƒ½åˆ†é…æ–°çš„ `frame_src`

**è§£å†³æ–¹æ¡ˆ**:
```rust
// é¢„åˆ†é…ç¼“å†²åŒºï¼Œé‡ç”¨
let mut vad_frame_buf = vec![0.0f32; vad_source_frame];
// åœ¨å¾ªç¯ä¸­é‡ç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ†é…
```

**é¢„æœŸæ•ˆæœ**: å‡å°‘å†…å­˜åˆ†é…å¼€é”€

---

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸä¼˜åŒ–ï¼‰

#### æ–¹æ¡ˆ 5: ä¼˜åŒ–é¢‘è°±ç‰¹å¾è®¡ç®—

**é—®é¢˜**: `compute_noise_features` åŒ…å«å¤§é‡å¯¹æ•°è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æŸ¥è¡¨æ³•æ›¿ä»£éƒ¨åˆ†å¯¹æ•°è®¡ç®—
- ä½¿ç”¨ SIMD ä¼˜åŒ–å¾ªç¯
- å‡å°‘è®¡ç®—ç²¾åº¦ï¼ˆå¦‚æœå¯æ¥å—ï¼‰

**é¢„æœŸæ•ˆæœ**: å‡å°‘è®¡ç®—è€—æ—¶ 20-30%

---

#### æ–¹æ¡ˆ 6: ä¼˜åŒ–åŠ¨æ€ EQ

**é—®é¢˜**: å¤šé¢‘æ®µå¤„ç†ç´¯ç§¯å¼€é”€

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘é¢‘æ®µæ•°é‡ï¼ˆä» 5 ä¸ªå‡å°‘åˆ° 3 ä¸ªï¼‰
- ä½¿ç”¨ SIMD ä¼˜åŒ–æ»¤æ³¢å™¨
- æ¡ä»¶å¤„ç†ï¼ˆåªåœ¨éœ€è¦æ—¶å¤„ç†ï¼‰

**é¢„æœŸæ•ˆæœ**: å‡å°‘åŠ¨æ€ EQ è€—æ—¶ 30-40%

---

#### æ–¹æ¡ˆ 7: å¼‚æ­¥å¤„ç†éå…³é”®åŠŸèƒ½

**é—®é¢˜**: æ‰€æœ‰å¤„ç†éƒ½åœ¨ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
- å°†é¢‘è°±æ¨é€ç§»åˆ°å¼‚æ­¥ä»»åŠ¡
- å°†éƒ¨åˆ†ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—ç§»åˆ°åå°çº¿ç¨‹

**é¢„æœŸæ•ˆæœ**: å‡å°‘ä¸»çº¿ç¨‹è€—æ—¶ 5-10%

---

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

#### æ–¹æ¡ˆ 8: ä½¿ç”¨æ›´è½»é‡çš„ DeepFilterNet æ¨¡å‹

**é—®é¢˜**: DeepFilterNet æ¨¡å‹è¾ƒå¤§ï¼Œæ¨ç†è€—æ—¶

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨é‡åŒ–æ¨¡å‹
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹å˜ä½“
- ä¼˜åŒ– ONNX Runtime é…ç½®

**é¢„æœŸæ•ˆæœ**: å‡å°‘ DeepFilterNet è€—æ—¶ 20-30%

---

#### æ–¹æ¡ˆ 9: ä½¿ç”¨æ›´è½»é‡çš„ VAD æ¨¡å‹

**é—®é¢˜**: Silero VAD æ¨¡å‹å¯èƒ½è¾ƒå¤§

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨é‡åŒ–æ¨¡å‹
- ä½¿ç”¨æ›´å°çš„ VAD æ¨¡å‹

**é¢„æœŸæ•ˆæœ**: å‡å°‘ VAD è€—æ—¶ 30-40%

---

## 6. ç«‹å³è¡ŒåŠ¨å»ºè®®

### å¿«é€Ÿä¿®å¤ï¼ˆå¯ç«‹å³å®æ–½ï¼‰

1. **é™åˆ¶ VAD å¤„ç†é¢‘ç‡**: æ¯å¸§æœ€å¤šå¤„ç†ä¸€æ¬¡ï¼Œä¸è¦ç”¨ while å¾ªç¯
2. **å‡å°‘é¢‘è°±æ¨é€é¢‘ç‡**: æ¯ 3 å¸§æ¨é€ä¸€æ¬¡
3. **é‡ç”¨ VAD ç¼“å†²åŒº**: é¢„åˆ†é…ï¼Œé¿å…æ¯æ¬¡åˆ†é…

**é¢„æœŸæ•ˆæœ**: å‡å°‘æ€»è€—æ—¶ 30-50%ï¼Œä» 47-94ms é™ä½åˆ° 25-50ms

---

### ä»£ç ä¿®æ”¹ç¤ºä¾‹

#### ä¿®æ”¹ 1: é™åˆ¶ VAD å¤„ç†é¢‘ç‡

```rust
// åŸä»£ç  (1238-1250è¡Œ)
while vad_buf_raw.len() >= vad_source_frame {
    let mut frame_src = vec![0.0f32; vad_source_frame];
    // ...
}

// ä¿®æ”¹ä¸º
if vad_buf_raw.len() >= vad_source_frame {
    // é¢„åˆ†é…ç¼“å†²åŒºï¼ˆåœ¨åˆå§‹åŒ–æ—¶ï¼‰
    // vad_frame_buf.resize(vad_source_frame, 0.0);
    for i in 0..vad_source_frame {
        if let Some(v) = vad_buf_raw.pop_front() {
            vad_frame_buf[i] = v;
        }
    }
    if let Some(ref mut v) = vad {
        if let Ok(_) = v.process(&vad_frame_buf) {
            vad_voice = v.is_speaking();
        }
    }
    // ä¸å†ä½¿ç”¨ whileï¼Œå‰©ä½™å¸§ç•™åˆ°ä¸‹ä¸€è½®
}
```

#### ä¿®æ”¹ 2: å‡å°‘é¢‘è°±æ¨é€é¢‘ç‡

```rust
// åŸä»£ç  (1880-1882è¡Œ)
if let Some((ref mut s_noisy, ref mut s_enh)) = s_spec.as_mut() {
    push_spec(df.get_spec_noisy(), s_noisy);
    push_spec(df.get_spec_enh(), s_enh);
}

// ä¿®æ”¹ä¸º
static mut SPEC_PUSH_COUNTER: usize = 0;
unsafe {
    SPEC_PUSH_COUNTER += 1;
    if SPEC_PUSH_COUNTER % 3 == 0 {
        if let Some((ref mut s_noisy, ref mut s_enh)) = s_spec.as_mut() {
            push_spec(df.get_spec_noisy(), s_noisy);
            push_spec(df.get_spec_enh(), s_enh);
        }
    }
}
```

---

## 7. æ€§èƒ½ç›‘æ§å»ºè®®

### æ·»åŠ ç»†ç²’åº¦æ€§èƒ½ç›‘æ§

```rust
let t_df = Instant::now();
lsnr = df.process(...)?;
let df_time = t_df.elapsed().as_millis();

let t_vad = Instant::now();
// VAD å¤„ç†
let vad_time = t_vad.elapsed().as_millis();

let t_env = Instant::now();
// ç¯å¢ƒè‡ªé€‚åº”
let env_time = t_env.elapsed().as_millis();

// è®°å½•å„é˜¶æ®µè€—æ—¶
if elapsed_ms > budget_ms * 1.5 {
    log::warn!(
        "æ€§èƒ½ç“¶é¢ˆ: DF={}ms, VAD={}ms, ENV={}ms, å…¶ä»–={}ms",
        df_time, vad_time, env_time, elapsed_ms - df_time - vad_time - env_time
    );
}
```

---

## 8. æ€»ç»“

**æ ¹æœ¬åŸå› **:
1. **DeepFilterNet AI æ¨ç†** (30-50%) - æ ¸å¿ƒåŠŸèƒ½ï¼Œæ— æ³•é¿å…
2. **VAD ONNX æ¨ç†** (20-40%) - while å¾ªç¯å¯¼è‡´å¤šæ¬¡æ¨ç†
3. **ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—** (10-20%) - å¤æ‚é€»è¾‘å’Œé¢‘è°±è®¡ç®—
4. **é¢‘è°±æ¨é€** (5-10%) - å†…å­˜åˆ†é…å’Œé€šé“å‘é€

**å…³é”®å‘ç°**:
- VAD çš„ while å¾ªç¯æ˜¯ä¸»è¦é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´å•å¸§å†…å¤šæ¬¡ ONNX æ¨ç†
- é¢‘è°±æ¨é€æ¯å¸§éƒ½æ‰§è¡Œï¼Œå¯ä»¥é™ä½é¢‘ç‡
- ç¯å¢ƒè‡ªé€‚åº”è®¡ç®—å¯ä»¥ä¼˜åŒ–

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… é™åˆ¶ VAD å¤„ç†é¢‘ç‡ï¼ˆæ¯å¸§ä¸€æ¬¡ï¼‰
2. âœ… å‡å°‘é¢‘è°±æ¨é€é¢‘ç‡ï¼ˆæ¯ 3 å¸§ä¸€æ¬¡ï¼‰
3. âœ… é‡ç”¨ VAD ç¼“å†²åŒº

**é¢„æœŸæ•ˆæœ**: æ€»è€—æ—¶ä» 47-94ms é™ä½åˆ° 25-50msï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥æ»¡è¶³ 30ms é¢„ç®—ã€‚

