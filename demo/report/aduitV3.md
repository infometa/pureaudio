音频处理项目审计与优化报告
项目背景

该项目位于 GitHub 仓库 infometa/pureaudio 的 demo 目录，目标是在固定录音环境下提高降噪后语音的还原度，尽可能接近参考录音 kh.wav。用户采用了高通滤波、DeepFilterNet（DFN）降噪、静态/动态均衡（EQ）、短时傅里叶变换（STFT）静态 EQ、瞬态增强、饱和、自动增益控制（AGC）、限幅等模块，均由 JSON 配置文件控制。

问题陈述

nc.wav：指经过高通和 DFN 处理后的基线音频，本身已经存在中高频整体下降、瞬态模糊等问题，是需要纠正的基准。

kh.wav：作为金标准参考音频，用于判定最理想的频谱形状与听感。

eq.wav：应用自定义配置后生成的音频，用于验证配置效果，但其中可能包含错误或调参失误，不能用于推导偏差。

项目目标是通过合理优化代码和参数，使输出尽量保留真实细节，控制噪音，并改善清晰度而不出现齿音或失真。

核心分析方法

对齐与频谱分析：对 nc.wav 与 kh.wav 做交叉相关对齐，通过 4096 点 FFT (Hann 窗，50% 重叠) 计算平均功率谱，求两者的差值，以 dB 为单位表示每个频段的偏差。分析结果表明：1 kHz 以上频段 nc 比 kh 普遍低约 4–6 dB，其中 8–12 kHz 更深 (-8 至 -12 dB)。250–500 Hz 区域接近 0 dB，但 250 Hz 以下明显偏瘦 (-8 dB)。

配置验证：仅通过对比 eq.wav 与 kh.wav 无法推导正确的补偿量，因为 eq.wav 可能包含错误实现或过度补偿；应以 nc.wav 和 kh.wav 之差推算补偿策略，再用 eq.wav 验证是否收敛。

代码层面的优化建议

STFT 实现

完美重建：确保 STFT/ISTFT 能保持能量和相位，使用 Hann 窗并严格 50% 重叠。避免在频域过度归一化或忽略逆窗导致能量损失。

可选开关：由于实测过 STFT 模块会导致音质下降，应提供完全关闭 STFT EQ 的选项，仅在后续确认实现无误再启用。

均衡模块调整

静态 EQ 作用：用于宽带补偿，解决中高频整体下降问题；建议使用宽带低 Q (≈0.7) 的 Peak/Shelf 滤波器，在 3–10 kHz 区域逐渐提升 2–3 dB，8–12 kHz 适度再加 1–2 dB，不宜超过 4 dB，以免放大 DFN 残留噪声。

动态 EQ（Dynamic EQ）：仅用于抑制局部问题，如齿音（通常在 5–8 kHz），带宽应窄，阈值较低 (例如 -55 dB)，比率 2:1；避免利用动态 EQ 实现整体倾斜，否则会产生压缩感。

均衡顺序：先执行高通和 DFN，再应用静态 EQ 调整体形状，最后使用动态 EQ 去齿，最后再经过 AGC 与限幅。

降噪参数优化

atten_lim：过高的最大衰减会消除有用细节，可将默认值 20–33 dB 调低至 15–18 dB；如果噪音较大，再适当提高。

min_threshdb：将噪声掩蔽阈值从 -60 dB 提高到约 -50 dB，防止轻声和气流被误判为噪声。

post_filter_beta：增加至 0.3–0.5，可平滑 DFN 的频谱掩膜，避免锯齿状失真。

AGC 和饱和

AGC 动态参数：建议目标响度 -20 LUFS，允许最大增益约 5 dB；攻击时长 ≥500 ms，释放时长 ≥2000 ms；避免短时强压导致呼吸声明显。

饱和/激励：若使用，建议轻度作用，确保配置 drive 和 mix 不超过 1–2 dB 增益，否则会增加谐波失真。

代码结构改进

模块化设计：将高通、降噪、静态 EQ、动态 EQ、AGC、STFT 均实现为独立函数/模块，便于单元测试、调试与组合；配置文件只负责参数，逻辑和算法不要写在配置解析中。

日志记录：在动态 EQ、AGC 阶段记录每帧的增益，以便后期分析某些频段被过度压缩或提升。

多 preset 支持：根据不同应用（如电话会议、录制、直播）提供可切换预置，而不是单个 “Broadcast”。

测试与可视化

频谱报告脚本：自动生成 kh/nc/eq 频谱及差值图，并给出关键频段平均偏差值，方便量化优化效果。

AB 试听与盲测：既要看频谱，也要用听感比较不同调参；可在固定环境播放 eq.wav 与 nc.wav，与 kh.wav 交替试听，防止“看图调音”。

行业参考

去齿器（de-esser）：专业软件（如 iZotope RX、Waves de-esser）多采用窄带压缩，在 5–8 kHz 区间检测能量峰值并轻柔下降，建议模仿这种算法而非简单高架 EQ。

宽带补偿：优秀降噪工具会在降噪后轻度提升 presence（2–4 kHz）和空气感（10–12 kHz），但提升量一般不超过 3 dB，以免噪声重现。

AI 模型前瞻性：未来可考虑训练自定义的音色还原模型，例如利用自监督学习恢复 DFN 处理后失真的高频细节，替代手工 EQ。

总结与行动建议

基础原则：不再直接对比 eq.wav 而忽略 nc.wav 的差异；所有补偿须以 kh.wav 与 nc.wav 的差值为依据。

优先顺序：首先确保 DFN 不破坏太多有用信息，其次静态 EQ 修正主要偏差，再用动态 EQ 控制齿音，最后小心使用 AGC。

建议交付：未来调试中，只需要提供新的 nc.wav 和配置文件，便可推导合适的静态/动态 EQ 并产生优化建议；eq.wav 用于验证效果。

自动化脚本：建议编写工具，对比并输出频谱差值、生成初始 EQ 曲线，加快迭代效率。

通过这些优化和科学的调试流程，可以在固定的录音设备和环境下，实现更自然、更清晰的语音输出，尽量接近 kh.wav 的参考音质。