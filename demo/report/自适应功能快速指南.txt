========================================
  自适应配置系统 - 快速指南 v4.0
========================================

实现时间：2025-12-11
状态：✅ 已实现并编译成功

========================================
  核心功能
========================================

1. ✅ 设备类型自动识别
   - 内置麦克风、USB设备、会议音箱、专业接口

2. ✅ 音量自动监控和建议
   - 输入/输出能量监控
   - 每5秒检查并给出建议

3. ✅ AEC延迟自动估计
   - 互相关分析
   - 每10秒估计一次
   - 自动推荐最佳延迟

4. ✅ 环境噪声自适应
   - 动态调整降噪强度
   - 根据噪声底噪自动优化

========================================
  你的当前配置
========================================

硬件：
  输入：MacBook Pro内置麦克风
  输出：Mic 100会议音箱1

检测结果：
  设备类型：内置麦克风 + 会议音箱
  
推荐配置：
  ✅ AEC：开启
  ✅ 延迟：60ms（自动调整）
  ✅ AGC增益：9dB
  ⚠️  输出音量：30%（当前20dB过高！）

关键问题：
  ⚠️  你的扬声器音量是20dB，推荐降到10-12dB！
  这是啸叫的主要原因！

========================================
  如何使用
========================================

步骤1：启动程序

  ./target/release/df-demo

步骤2：观察自适应日志

  【音量警告】
  [WARN] ⚠️  音量调整建议: 输出过高 | 
         当前:20.0dB 推荐:-25.0dB | 
         输出音量过高，可能导致啸叫
  
  → 看到这个警告，立即降低音量！

  【延迟建议】
  [INFO] 🔍 AEC延迟自动估计: 85ms (相关性: 0.423)
  [INFO] 💡 AEC延迟建议: 当前60ms → 推荐85ms
  
  → 在UI中调整"回声延迟补偿"

步骤3：调整硬件设置

  【降低扬声器音量】⭐⭐⭐
  1. 打开macOS"音频MIDI设置"
  2. 选择"Mic 100会议音箱1"
  3. 将音量从20dB降到10-12dB
  
  【调整AEC延迟】
  1. 在程序UI中
  2. 找到"回声延迟补偿"滑块
  3. 从60ms调到推荐值

步骤4：重新测试

  - 双讲测试
  - 啸叫测试
  - 观察效果

========================================
  预期效果
========================================

【音量监控】✅
  - 输出过高 → 立即警告
  - 输入过低 → 建议调整麦克风增益
  - 输入过高 → 警告可能削波

【延迟估计】✅
  - 自动分析最佳延迟
  - 相关性 > 0.3 → 可信度高
  - 给出调整建议

【噪声自适应】✅
  - 安静环境 → 轻度降噪（保留音质）
  - 噪声环境 → 强降噪（35dB）

【设备识别】✅
  - 自动识别设备类型
  - 推荐最佳配置

========================================
  常见日志示例
========================================

【正常运行】
[INFO] 🎙️ AEC诊断 | 场景:双讲保护中 | 
       VAD:✓ Render:✓ | 
       能量: Near=-25dB Far=-35dB Diff=+10dB | 
       suppression=Low

【音量警告】
[WARN] ⚠️  音量调整建议: 输出过高 | 
       当前:20.0dB 推荐:-25.0dB | 
       输出音量过高，可能导致啸叫

【延迟估计】
[INFO] 🔍 AEC延迟自动估计: 85ms (相关性: 0.423)
[INFO] 💡 AEC延迟建议: 当前60ms → 推荐85ms

========================================
  问题排查
========================================

Q1: 没有看到音量警告
A1: 说明音量在合理范围内，很好！

Q2: 没有看到延迟估计
A2: 1. 确保开启"自动播放测试音频"
    2. 确保扬声器正常播放
    3. 需要等待至少10秒

Q3: 延迟建议频繁变化
A3: 相关性分析受环境影响
    建议手动微调±10ms观察效果

Q4: 仍然有啸叫
A4: ⚠️  最重要：降低扬声器音量！
    从20dB降到10-12dB
    这是第一优先级！

========================================
  关键建议
========================================

⭐⭐⭐ 最重要的调整：

  降低扬声器音量从20dB → 10-12dB
  
  原因：
  - 音量过高是啸叫的根本原因
  - 音量过高导致回声很强
  - 即使AEC也难以完全消除

其他建议：

  1. 根据延迟估计调整AEC延迟
  2. 保持麦克风和扬声器距离>30cm
  3. 使用海绵板吸音
  4. 观察日志中的能量值

========================================
  技术细节
========================================

设备识别算法：
  - 根据设备名称关键词匹配
  - 支持中英文识别
  - 覆盖主流设备品牌

音量监控：
  - 5秒滑动平均
  - 每5秒检查一次
  - 阈值：输出>-15dB、输入>-5dB

延迟估计：
  - 互相关分析
  - 搜索范围：0-200ms
  - 每10秒估计一次
  - 最小相关性：0.1

噪声自适应：
  - 监控噪声底噪
  - 动态调整降噪强度
  - 25-35dB自适应范围

性能开销：
  - CPU：< 1%
  - 内存：< 200KB
  - 几乎可以忽略

========================================
  未来扩展（可选）
========================================

短期：
  - UI显示自适应建议
  - 一键应用推荐配置
  - 设备配置文件保存

长期：
  - 机器学习优化
  - 网络延迟补偿
  - 多麦克风阵列支持

========================================
  相关文档
========================================

详细说明：
  - 自适应配置系统说明.md（完整技术文档）

其他文档：
  - 啸叫和吞字问题修复方案.md
  - UI状态同步修复说明.md
  - 快速测试指南-v2.txt

========================================

实现完成时间：2025-12-11
版本：v4.0
状态：✅ 已实现并编译成功

现在可以测试自适应功能了！

重要提醒：
  ⚠️  第一步：降低扬声器音量从20dB → 10-12dB
  ⚠️  这是解决啸叫的关键！

========================================
