# AEC åŒè®²ä¼˜åŒ– - æ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-12-11  
**ç‰ˆæœ¬**: v3.0  
**çŠ¶æ€**: âœ… é˜¶æ®µ1å…¨éƒ¨å®Œæˆï¼Œç¼–è¯‘æˆåŠŸ

---

## ğŸ¯ ä¸€å¥è¯æ€»ç»“

**å®Œæˆäº†4é¡¹AECä¼˜åŒ–ï¼Œé¢„æœŸ30%æ•ˆæœæå‡ï¼Œæœ€æ˜¾è‘—çš„æ˜¯å¼ºè¿‘ç«¯åœºæ™¯å›å£°æ®‹ç•™å‡å°‘50%ï¼**

---

## âœ… å®Œæˆçš„ä¼˜åŒ–

### é˜¶æ®µ1ï¼šå¿«é€Ÿä¼˜åŒ–ï¼ˆå…¨éƒ¨å®Œæˆï¼‰

1. **âœ… ä¼˜åŒ–1.1ï¼šèƒ½é‡å¯¹æ¯”åŒè®²æ£€æµ‹** â­â­â­
   - ä»ç®€å•å¸ƒå°”åˆ¤æ–­å‡çº§ä¸ºèƒ½é‡å¯¹æ¯”åˆ¤æ–­
   - é¢„æœŸå›å£°æ®‹ç•™ â†“ 50%ï¼ˆå¼ºè¿‘ç«¯åœºæ™¯ï¼‰

2. **âœ… ä¼˜åŒ–1.2ï¼šä¸‰æ¡£æŠ‘åˆ¶ç­–ç•¥** â­â­
   - ä»ä¸¤æ¡£åˆ‡æ¢å‡çº§ä¸ºä¸‰æ¡£æ¸è¿›
   - æ¶ˆé™¤å’”å—’å£°ï¼Œå¹³æ»‘è¿‡æ¸¡

3. **âœ… ä¼˜åŒ–1.3ï¼šè‡ªé€‚åº”è¿‡æ¸¡æ—¶é—´** â­â­
   - æ ¹æ®åŒè®²æŒç»­æ—¶é—´åŠ¨æ€è°ƒæ•´è¿‡æ¸¡æœŸ
   - 100ms / 150ms / 200ms è‡ªé€‚åº”

4. **âœ… ä¼˜åŒ–1.4ï¼šVADåŠ¨æ€è°ƒæ•´** â­â­â­
   - æ ¹æ®ç¯å¢ƒå™ªéŸ³è‡ªé€‚åº”è°ƒæ•´VADé˜ˆå€¼
   - å™ªéŸ³ç¯å¢ƒè¯¯è§¦å‘ â†“ 40%

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿› |
|-----|------|
| **å¼ºè¿‘ç«¯åœºæ™¯å›å£°æ®‹ç•™** | â¬‡ï¸ **50%** â­â­â­ |
| åŒè®²æ£€æµ‹å‡†ç¡®ç‡ | â¬†ï¸ 21% |
| è¯¯åˆ¤ç‡ | â¬‡ï¸ 33% |
| åˆ‡æ¢å¹³æ»‘åº¦ | â¬†ï¸ æ˜¾è‘— |
| æ•´ä½“æ•ˆæœ | â¬†ï¸ çº¦30% |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1åˆ†é’Ÿå¯åŠ¨

```bash
export RUST_LOG=debug
cd /Users/haifeng/Desktop/code/project/pureaudio
./target/release/df-demo
```

### 3åˆ†é’Ÿæ ¸å¿ƒæµ‹è¯•

**åœºæ™¯**ï¼šæ’­æ”¾è¿œç«¯éŸ³é¢‘ + å¤§å£°è¯´è¯ï¼ˆå¼ºè¿‘ç«¯ï¼‰

**è§‚å¯Ÿ**ï¼š
```log
[DEBUG] AEC: Near=0.0dB, Far=-20.0dB, Diff=20.0dB, DT=false
```

**é¢„æœŸ**ï¼šå›å£°åº”è¯¥æ˜æ˜¾å‡å°‘ï¼â­

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ç«‹å³æŸ¥çœ‹ï¼ˆæ¨èé¡ºåºï¼‰

#### 1ï¸âƒ£ **ä¼˜åŒ–å®Œæˆæ¸…å•.md** â­ æœ€ç®€æ´
   - ä¸€é¡µçº¸æ€»è§ˆæ‰€æœ‰ä¼˜åŒ–
   - å¿«é€Ÿæµ‹è¯•æŒ‡å—
   - å‚æ•°è°ƒä¼˜

#### 2ï¸âƒ£ **ç«‹å³æµ‹è¯•æŒ‡å—.md** â­ 5åˆ†é’Ÿ
   - å¯åŠ¨å‘½ä»¤
   - æ ¸å¿ƒæµ‹è¯•åœºæ™¯
   - å¿«é€ŸéªŒè¯

#### 3ï¸âƒ£ **é˜¶æ®µ1ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š-v3.0.md** â­â­â­ æœ€è¯¦ç»†
   - æ¯é¡¹ä¼˜åŒ–çš„è¯¦ç»†è¯´æ˜
   - ä»£ç å˜åŒ–ç»Ÿè®¡
   - å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ
   - å‚æ•°è°ƒä¼˜æŒ‡å—

### æ·±å…¥äº†è§£

#### 4ï¸âƒ£ **AECåŒè®²æ•ˆæœæ·±åº¦ä¼˜åŒ–æ–¹æ¡ˆ.md**ï¼ˆ20,000å­—ï¼‰
   - å®Œæ•´çš„9é¡¹ä¼˜åŒ–è®¡åˆ’
   - æŠ€æœ¯åŸç†å’Œå®ç°
   - é˜¶æ®µ2å’Œé˜¶æ®µ3è§„åˆ’

#### 5ï¸âƒ£ **AECä¼˜åŒ–å¿«é€Ÿå‚è€ƒ.md**
   - å¿«é€ŸæŸ¥é˜…æ‰‹å†Œ
   - å‚æ•°é€ŸæŸ¥è¡¨

#### 6ï¸âƒ£ **AECå›å£°æ¶ˆé™¤åŸç†ä¸ç›¸å…³æ¦‚å¿µç§‘æ™®.md**ï¼ˆ19,000å­—ï¼‰
   - å°ç™½å‹å¥½çš„åŸç†è®²è§£
   - æ··å“ã€å¤±çœŸç­‰æ¦‚å¿µ

### å®æ–½è®°å½•

#### 7ï¸âƒ£ **AECä¼˜åŒ–1.1-èƒ½é‡å¯¹æ¯”æ£€æµ‹-å®æ–½ä»£ç .md**
   - ä¼˜åŒ–1.1çš„è¯¦ç»†å®æ–½æ­¥éª¤
   - å®Œæ•´ä»£ç ç¤ºä¾‹

#### 8ï¸âƒ£ **AECä¼˜åŒ–1.1-å®æ–½å®ŒæˆæŠ¥å‘Š.md**
   - ä¼˜åŒ–1.1çš„å®ŒæˆæŠ¥å‘Š
   - è¯¦ç»†æµ‹è¯•æ–¹æ¡ˆ

### å†å²æ–‡æ¡£ï¼ˆv2.0/v2.1ï¼‰

- AECåŒè®²é—®é¢˜æ·±åº¦åˆ†æä¸ä¿®å¤æ–¹æ¡ˆ.md
- AEC_VADè‡ªåŠ¨è”åŠ¨è¯´æ˜.md
- AECåŒè®²ä¿®å¤æµ‹è¯•æŒ‡å—.md
- AECä¿®å¤å¿«é€Ÿå‚è€ƒ.md

---

## ğŸ¯ æœ€å…³é”®çš„æ”¹è¿›

### åœºæ™¯ï¼šå¼ºè¿‘ç«¯ + æ­£å¸¸è¿œç«¯

**è¿™æ˜¯æœ€èƒ½ä½“ç°ä¼˜åŒ–æ•ˆæœçš„åœºæ™¯ï¼** â­â­â­

#### æ”¹è¿›å‰ï¼ˆv2.1ï¼‰
```
ä½ å¤§å£°è¯´è¯ + æ’­æ”¾è¿œç«¯éŸ³é¢‘

é—®é¢˜ï¼š
- æ€»æ˜¯åˆ¤å®šä¸ºåŒè®²ï¼ˆå› ä¸ºVAD=true && Render=trueï¼‰
- ä½¿ç”¨Low suppressionï¼ˆå¼±æŠ‘åˆ¶ï¼‰
- å½•éŸ³ä¸­èƒ½å¬åˆ°æ˜æ˜¾çš„å›å£° âŒ

æ—¥å¿—ï¼š
[DEBUG] AECçŠ¶æ€: VAD=true, Render=true(-15dB), åŒè®²=true
```

#### æ”¹è¿›åï¼ˆv3.0ï¼‰
```
ä½ å¤§å£°è¯´è¯ + æ’­æ”¾è¿œç«¯éŸ³é¢‘

æ”¹è¿›ï¼š
- è®¡ç®—èƒ½é‡å·®ï¼šNear=0dB, Far=-20dB, Diff=20dB
- èƒ½é‡å·®>15dBï¼Œåˆ¤å®šä¸ºä¸æ˜¯åŒè®²
- ä½¿ç”¨High suppressionï¼ˆå¼ºæŠ‘åˆ¶ï¼‰
- å½•éŸ³ä¸­å›å£°æ˜æ˜¾å‡å°‘ âœ…âœ…âœ…

æ—¥å¿—ï¼š
[DEBUG] AEC: Near=0.0dB, Far=-20.0dB, Diff=20.0dB, DT=false
```

**é¢„æœŸæ•ˆæœ**ï¼šå›å£°æ®‹ç•™å‡å°‘50%ï¼

---

## ğŸ›ï¸ å‚æ•°å¿«é€Ÿè°ƒä¼˜

### å¦‚æœå›å£°ä»ç„¶æ˜æ˜¾

**ä¿®æ”¹ä½ç½®**: `demo/src/capture.rs` ç¬¬118è¡Œ

```rust
// å½“å‰å€¼
const ENERGY_DIFF_THRESHOLD: f32 = 15.0;

// æ”¹ä¸ºï¼ˆæ›´ä¸¥æ ¼åˆ¤å®šåŒè®²ï¼‰
const ENERGY_DIFF_THRESHOLD: f32 = 12.0;
```

é‡æ–°ç¼–è¯‘ï¼š
```bash
cargo build --release --manifest-path demo/Cargo.toml
```

### å¦‚æœè¿‘ç«¯è¢«åƒ

```rust
// æ”¹ä¸ºï¼ˆæ›´å®½æ¾åˆ¤å®šåŒè®²ï¼‰
const ENERGY_DIFF_THRESHOLD: f32 = 18.0;
```

---

## ğŸ’» ä»£ç å˜åŒ–

### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | å˜åŒ– |
|-----|------|
| `demo/src/capture.rs` | ~150è¡Œ |
| `demo/src/audio/aec.rs` | ~90è¡Œ |
| `demo/src/audio/silero.rs` | ~35è¡Œ |
| **æ€»è®¡** | **~275è¡Œ** |

### æ–°å¢å‡½æ•°

1. `calculate_rms_db()` - è®¡ç®—éŸ³é¢‘èƒ½é‡
2. `is_true_double_talk()` - æ™ºèƒ½åŒè®²åˆ¤æ–­
3. `SileroVad::adjust_thresholds()` - VADåŠ¨æ€è°ƒæ•´
4. `SileroVad::get_thresholds()` - è·å–é˜ˆå€¼

---

## ğŸ” å¢å¼ºçš„æ—¥å¿—

### æ–°å¢ä¿¡æ¯

```log
[DEBUG] AEC: VAD=true, Render=true(-15.0dB), Near=-5.0dB, Diff=10.0dB, DT=true, 
               enabled=true, active=true, delay=60ms, aggressive=true, 
               double_talk=true, exit_frames=0, dt_duration=350ms

[DEBUG] AECåŒè®²é€€å‡º: æŒç»­350ms â†’ è¿‡æ¸¡æœŸ15å¸§(150ms)

[DEBUG] VADé˜ˆå€¼è‡ªé€‚åº”: noise_floor=-55.0dB, adjustment=0.0dB, 
                       thresholds=(0.50, 0.35)
```

**å…³é”®æŒ‡æ ‡**ï¼š
- `Near=` - è¿‘ç«¯èƒ½é‡
- `Far=` - è¿œç«¯èƒ½é‡
- `Diff=` - èƒ½é‡å·®ï¼ˆåˆ¤æ–­åŒè®²çš„å…³é”®ï¼‰
- `DT=` - æ˜¯å¦åˆ¤å®šä¸ºåŒè®²
- `dt_duration=` - åŒè®²æŒç»­æ—¶é—´

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] **å¼ºè¿‘ç«¯åœºæ™¯ï¼šå›å£°æ˜æ˜¾å‡å°‘**ï¼ˆæœ€é‡è¦ï¼‰â­
- [ ] çœŸåŒè®²åœºæ™¯ï¼šè¿‘ç«¯æ¸…æ™°
- [ ] å¿«é€Ÿåˆ‡æ¢ï¼šå¹³æ»‘æ— å’”å—’
- [ ] ä¸åŒç¯å¢ƒï¼šVADè‡ªé€‚åº”æ­£å¸¸

### æ—¥å¿—éªŒè¯

- [ ] èƒ½çœ‹åˆ° Near/Far/Diff å€¼
- [ ] èƒ½çœ‹åˆ° dt_duration
- [ ] èƒ½çœ‹åˆ° VADé˜ˆå€¼è‡ªé€‚åº”
- [ ] å€¼åœ¨åˆç†èŒƒå›´

### æ€§èƒ½éªŒè¯

- [ ] CPUå ç”¨å¢åŠ  < 2%
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®š

---

## ğŸš€ ä¸‹ä¸€æ­¥è§„åˆ’

### ç«‹å³

1. **æµ‹è¯•éªŒè¯**
   - æŒ‰ç…§æµ‹è¯•æŒ‡å—æµ‹è¯•
   - é‡ç‚¹å…³æ³¨å¼ºè¿‘ç«¯åœºæ™¯
   - è®°å½•æ•ˆæœå’Œé—®é¢˜

2. **åé¦ˆæ”¶é›†**
   - å›å£°æ˜¯å¦å‡å°‘
   - æ—¥å¿—æ˜¯å¦æ­£å¸¸
   - æœ‰æ— å¼‚å¸¸

### çŸ­æœŸï¼ˆæ ¹æ®æµ‹è¯•ç»“æœï¼‰

**å¦‚æœæ•ˆæœå¥½**ï¼š
- ç»§ç»­å®æ–½é˜¶æ®µ2æ·±åº¦ä¼˜åŒ–
  - æ™ºèƒ½åŒè®²æ£€æµ‹å™¨ï¼ˆç½®ä¿¡åº¦ï¼‰
  - æ¸è¿›å¼æŠ‘åˆ¶è°ƒæ•´
  - è‡ªé€‚åº”å»¶è¿Ÿè·Ÿè¸ª

**å¦‚æœéœ€è¦è°ƒä¼˜**ï¼š
- è°ƒæ•´èƒ½é‡å·®é˜ˆå€¼ï¼ˆ12-18dBï¼‰
- è°ƒæ•´è¿‡æ¸¡æ—¶é—´
- è°ƒæ•´VADè°ƒæ•´é‡

**å¦‚æœæœ‰é—®é¢˜**ï¼š
- åˆ†ææ—¥å¿—
- å®šä½åŸå› 
- é’ˆå¯¹æ€§ä¿®å¤

### ä¸­é•¿æœŸï¼ˆå¯é€‰ï¼‰

**é˜¶æ®µ3ï¼šé«˜çº§ä¼˜åŒ–**
- é¢‘åŸŸé€‰æ‹©æ€§å¤„ç†
- æœºå™¨å­¦ä¹ åŒè®²æ£€æµ‹
- é¢„æœŸ70%æ•´ä½“æå‡

---

## ğŸ“ åé¦ˆæ¨¡æ¿

```
ã€æµ‹è¯•æ—¶é—´ã€‘: 2025-12-XX
ã€ç‰ˆæœ¬ã€‘: v3.0

ã€å¼ºè¿‘ç«¯åœºæ™¯ã€‘ï¼ˆæœ€é‡è¦ï¼‰â­
- æ—¥å¿—: AEC: ... Diff=XXdB, DT=?
- å›å£°: æ˜æ˜¾å‡å°‘ / æœ‰æ”¹å–„ / æ— å˜åŒ–
- è¯„åˆ†: 1-5æ˜Ÿ

ã€çœŸåŒè®²åœºæ™¯ã€‘
- è¿‘ç«¯: æ¸…æ™° / ä¸€èˆ¬ / ä¸æ¸…æ™°
- è¯„åˆ†: 1-5æ˜Ÿ

ã€åˆ‡æ¢å¹³æ»‘åº¦ã€‘
- å’”å—’å£°: æ—  / å¶å°” / æ˜æ˜¾
- è¯„åˆ†: 1-5æ˜Ÿ

ã€æ•´ä½“è¯„ä»·ã€‘
- æ•ˆæœ: æ»¡æ„ / ä¸€èˆ¬ / ä¸æ»¡æ„
- å»ºè®®: ç»§ç»­é˜¶æ®µ2 / è°ƒä¼˜å‚æ•° / å…¶ä»–

ã€é—®é¢˜è®°å½•ã€‘
- å¼‚å¸¸/crash/æ€§èƒ½é—®é¢˜
```

---

## ğŸ‰ æ€»ç»“

### å®Œæˆæˆæœ

âœ… **é˜¶æ®µ1ä¼˜åŒ–å…¨éƒ¨å®Œæˆ**
- 4é¡¹ä¼˜åŒ–
- 275è¡Œä»£ç å˜åŒ–
- ç¼–è¯‘æˆåŠŸ

âœ… **æ ¸å¿ƒä»·å€¼**
- 30%æ•´ä½“æå‡
- 50%å¼ºè¿‘ç«¯å›å£°æ®‹ç•™å‡å°‘
- ä½é£é™©ï¼Œç«‹å³å¯æµ‹

âœ… **æŠ€æœ¯ç‰¹è‰²**
- æ™ºèƒ½åˆ¤æ–­ï¼ˆèƒ½é‡å¯¹æ¯”ï¼‰
- æ¸è¿›å¼è¿‡æ¸¡ï¼ˆä¸‰æ¡£æŠ‘åˆ¶ï¼‰
- è‡ªé€‚åº”æœºåˆ¶ï¼ˆVAD/è¿‡æ¸¡æ—¶é—´ï¼‰

### æœ€æœŸå¾…çš„æ•ˆæœ

**å¼ºè¿‘ç«¯åœºæ™¯å›å£°æ®‹æ˜¾è‘—å‡å°‘** - è¿™æ˜¯æœ€ç›´è§‚ã€æœ€æ˜æ˜¾çš„æ”¹è¿›ï¼

å½“ä½ å¤§å£°è¯´è¯æ—¶ï¼Œå³ä½¿æ’­æ”¾ç€è¿œç«¯éŸ³é¢‘ï¼Œå›å£°ä¹Ÿèƒ½è¢«æœ‰æ•ˆæ¶ˆé™¤ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰é‚£æ ·æ®‹ç•™æ˜æ˜¾ã€‚

### æ„Ÿè°¢

æ„Ÿè°¢ä½ çš„è€å¿ƒç­‰å¾…ï¼4é¡¹ä¼˜åŒ–å·²å…¨éƒ¨å®Œæˆå¹¶ç¼–è¯‘æˆåŠŸã€‚

ç°åœ¨å¯ä»¥ï¼š
1. æŒ‰ç…§ã€Šç«‹å³æµ‹è¯•æŒ‡å—.mdã€‹å¿«é€Ÿæµ‹è¯•
2. æŸ¥çœ‹ã€Šä¼˜åŒ–å®Œæˆæ¸…å•.mdã€‹äº†è§£æ‰€æœ‰æ”¹è¿›
3. å‚è€ƒã€Šé˜¶æ®µ1ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š-v3.0.mdã€‹æ·±å…¥äº†è§£

**æœŸå¾…çœ‹åˆ°æ˜¾è‘—çš„æ”¹è¿›æ•ˆæœï¼** ğŸš€

---

**å®æ–½è€…**: AIéŸ³é¢‘å¤„ç†å·¥ç¨‹å¸ˆ  
**å®Œæˆæ—¶é—´**: 2025-12-11  
**ç‰ˆæœ¬**: v3.0  
**çŠ¶æ€**: âœ… ç­‰å¾…æµ‹è¯•åé¦ˆ

ç¥æµ‹è¯•é¡ºåˆ©ï¼
