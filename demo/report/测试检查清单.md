# Demo 代码修复测试检查清单

**版本**: v1.0  
**日期**: 2025-12-11  
**状态**: 等待测试

---

## 快速验证（5分钟）

### 1. 编译验证
```bash
cd /Users/haifeng/Desktop/code/project/pureaudio
cargo build --manifest-path demo/Cargo.toml --release
```
- [ ] 编译通过，无错误
- [ ] 警告仅为未使用方法（可接受）

### 2. 基础运行
```bash
cargo run --manifest-path demo/Cargo.toml --release --features ui
```
- [ ] 程序正常启动
- [ ] UI界面显示正常
- [ ] 音频输入/输出正常
- [ ] 无crash或panic

### 3. 参数调整
在UI中调整以下参数，观察是否正常：
- [ ] AGC启用/禁用
- [ ] 饱和度 Drive/Mix
- [ ] 瞬态整形 Attack/Sustain
- [ ] EQ调整
- [ ] 无zipper噪声或爆音

---

## 关键功能测试（30分钟）

### AGC测试
- [ ] 小声说话，音量正常提升（不会太响）
- [ ] 大声说话，音量不会过载
- [ ] 电平显示在 -12dBFS 附近
- [ ] 切换启用/禁用平滑无爆音

### 饱和度测试
- [ ] Drive=1.0：几乎无失真
- [ ] Drive=2.0：温和饱和感
- [ ] Mix调整无zipper噪声
- [ ] 输出电平稳定，无突然增大

### 瞬态整形测试
- [ ] 打字声/敲击：瞬态增强明显
- [ ] 持续语音：不受影响
- [ ] Sensitivity调整响应正确
- [ ] Attack Gain负值能压制瞬态

### Highpass滤波器
- [ ] Cutoff=50Hz：自然声音
- [ ] Cutoff=20Hz：与旁路接近
- [ ] Cutoff=150Hz：明显低频衰减
- [ ] 参数调整无爆音

### 激励器
- [ ] Mix=0：无效果
- [ ] Mix=1.0：高频增强明显
- [ ] 不会引起失真或爆音
- [ ] 音频流切换无杂音

---

## 稳定性测试（1小时）

### 长时间运行
- [ ] 运行1小时，无crash
- [ ] CPU占用稳定
- [ ] 内存占用稳定（无泄漏）
- [ ] 音质无劣化

### 参数扫描
循环修改各参数（每5秒改变一次）：
- [ ] 无crash或错误
- [ ] 参数平滑过渡
- [ ] 无异常噪声

### 音频流切换
- [ ] 切换输入设备
- [ ] 切换输出设备  
- [ ] 切换采样率
- [ ] 所有模块正常reset

---

## 边界条件测试（30分钟）

### 极端参数
测试所有参数的最小/最大值：
- [ ] AGC: target_level=0/31, compression=0/90
- [ ] Saturation: drive=0.5/2.0, makeup=-12/+6
- [ ] TransientShaper: attack_gain=-12/+12
- [ ] Highpass: cutoff=20/2000Hz
- [ ] 所有情况无crash

### 异常输入
- [ ] 静音输入（0.0）
- [ ] 微小信号（1e-6）
- [ ] 接近饱和（0.99）
- [ ] 所有模块正常处理

### 采样率测试
- [ ] 8kHz: VAD正常（如果使用）
- [ ] 16kHz: VAD正常
- [ ] 48kHz: 所有模块正常
- [ ] 96kHz: 所有模块正常

---

## 音质评估（主观测试）

### 对比测试
录制同一段语音，开启/关闭各模块，对比：

#### AGC
- [ ] 开启：小声说话清晰，大声不过载
- [ ] 关闭：动态范围保持
- [ ] 评级: ⭐⭐⭐⭐⭐

#### 饱和度
- [ ] Drive适中：温暖感，不明显失真
- [ ] Drive过高：明显失真但可控
- [ ] 评级: ⭐⭐⭐⭐⭐

#### 瞬态整形
- [ ] 打字/敲击声：增强/压制明显
- [ ] 语音：自然，不受影响
- [ ] 评级: ⭐⭐⭐⭐⭐

#### 整体
- [ ] 信号链无明显瑕疵
- [ ] 电平适中，无过载
- [ ] 延迟可接受
- [ ] 评级: ⭐⭐⭐⭐⭐

---

## 性能测试

### CPU占用
使用系统监控工具测量：
- [ ] 空载: ____%
- [ ] 仅DF: ____%
- [ ] 全部模块: ____%
- [ ] 总占用 < 50%（单核）

### 延迟测量
使用环回测试：
- [ ] 输入->输出延迟: ___ms
- [ ] 延迟 < 50ms（可接受）
- [ ] 延迟 < 20ms（优秀）

### 内存占用
- [ ] 启动后: ___MB
- [ ] 运行1小时: ___MB
- [ ] 增长 < 10MB（可接受）

---

## 日志检查

### 关键日志
查看日志文件/控制台，检查：
- [ ] 无ERROR级别日志
- [ ] WARN日志合理（如参数不支持）
- [ ] 无频繁的稳定性警告（<每秒1次）

### 稳定性警告
如果出现以下警告，记录频率：
- [ ] "HighpassFilter 系数不稳定": ___次/分钟
- [ ] "Biquad 系数不稳定": ___次/分钟
- [ ] "检测到非有限值输入": ___次/分钟

**期望**: 所有警告 < 1次/分钟

---

## 回归测试

### 与修复前对比
- [ ] 功能无退化
- [ ] 音质相同或更好
- [ ] 性能相同或更好
- [ ] 稳定性明显改善

---

## 已知限制

### 性能瓶颈（已记录，暂不影响使用）
1. **TimbreRestore**: 每帧~600KB堆分配（ort 2.0限制）
2. **SileroVAD**: 仍有部分to_vec()开销
3. **AEC**: 渲染帧拷贝

### 功能限制
1. **AGC.current_gain_db()**: 返回None（WebRTC限制）
2. **TransientShaper**: 全湿处理，无dry/wet混合
3. **SileroVAD**: 仅支持8k/16kHz采样率

---

## 问题报告模板

如发现问题，请记录：

```
【问题类型】: crash / 错误 / 音质 / 性能
【复现步骤】:
1. 
2. 
3. 

【期望行为】:

【实际行为】:

【环境信息】:
- 操作系统: 
- 采样率: 
- 缓冲区大小: 

【日志】:
（粘贴相关日志）

【严重程度】: P0(阻塞) / P1(严重) / P2(一般) / P3(轻微)
```

---

## 测试签名

- [ ] 快速验证 - 测试人: _________ 日期: _________
- [ ] 关键功能 - 测试人: _________ 日期: _________
- [ ] 稳定性 - 测试人: _________ 日期: _________
- [ ] 边界条件 - 测试人: _________ 日期: _________
- [ ] 音质评估 - 测试人: _________ 日期: _________
- [ ] 性能测试 - 测试人: _________ 日期: _________

**总体评估**: ⭐⭐⭐⭐⭐  
**建议**: □ 通过 □ 有条件通过 □ 不通过

---

**文档版本**: 1.0  
**创建日期**: 2025-12-11
