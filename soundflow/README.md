# soundflow 项目使用说明

## 项目简介

本仓库是一个中文化的音频处理示例项目，基于 DeepFilterNet 模型，扩展实现了以下特性：

1. **多环境自适应降噪**（根据噪声能量与频谱特征切换降噪阈值）。
2. **输入设备校准与自动增益控制**（统一采样率 48 kHz，自动调整输入电平）。
3. **高通滤波、瞬态整形、饱和失真与均衡器**（去除低频隆隆、改善语音质感）。
4. **总线限幅与硬限制**（防止后级过载，输出稳定）。

项目旨在展示如何将现代降噪模型与经典音频处理模块组合，并用简单的环境分析实现自适应控制。

## 使用方式（离线处理）

目前提供一个离线命令行工具，可对单声道 48 kHz 的 WAV 文件进行降噪和音色处理。如果需要实时处理麦克风输入，需自行集成音频 I/O 库。

### 依赖安装

1. **Rust 工具链**：安装 rustup 并配置 Rust 2021 版。
2. **Git**：用于克隆仓库并管理代码。
3. **可选模型文件**：默认加载 df crate 内置模型，亦可下载 `.df` 文件作为自定义模型。

### 构建与运行

假设您已经解压项目并进入 `soundflow` 目录，可以按照以下步骤操作：

* 构建：

    cargo build --release

* 运行离线处理工具：

    cargo run --release -- <输入文件>.wav <输出文件>.wav [模型文件.df]

例如：

    cargo run --release -- input.wav output.wav

说明：输入文件必须是单声道、采样率 48 kHz 的 WAV 文件；若采样率不同请提前转换。第三个参数可选，用于指定自定义模型路径。

## 自定义参数

核心逻辑位于 `src/processor.rs`，其中各种参数均可修改。例如：

- 在 `env_preset.rs` 中定义不同环境的降噪衰减、阈值和高通截止频率。
- 在 `noise_analysis.rs` 中修改噪声特征计算或分类阈值。
- 在 `dsp/highpass.rs`、`transient.rs`、`saturation.rs`、`eq.rs` 中调节各处理模块的默认参数和混合比例。
- 在 `dsp/agc.rs` 与 `dsp/bus_limiter.rs` 中调节 AGC 目标电平、最大增益或限幅阈值。

根据不同场景，您可以在 `processor.rs` 中按需求切换 EQ 预设或调整瞬态/饱和参数。

## 项目改进

与原始 DeepFilterNet 示例相比，本项目加入完整的音频处理链路、环境自适应逻辑以及中文注释，适合中文开发者学习和扩展。若需进一步增强（例如实时音频输入、动态均衡器），可在此基础上继续开发。

## 反馈与贡献

欢迎提交 issue 或 pull request 提出改进建议，共同完善音频处理方案。